#!/bin/bash

prog=$0

usage() {
	cat <<-EOF
		$prog <executable> <output_file>
	EOF
}

[ $# -eq 2 ] || { usage;  exit 1; }

lddresult=`ldd $1`
lddstatus=$?
if [ $lddstatus -eq 0 ]; then
	gawk 'match ($0, /(\/.*\.so(\.[0-9]+)?)/, ary) {
		  		path=ary[1]
				n=split(path, pathvar, "/")
				printf "COPY %s %s\n", pathvar[n], path}' <<-EOF | tee -a $2
		$lddresult
	EOF
else
	echo "ldd failed"; exit 1;
fi
